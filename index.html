<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>이미지를 영상으로 변환</title>
  <link rel="stylesheet" href="app.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>이미지를 영상으로 변환</h1>
      <p>여러 이미지를 선택하고 각 이미지의 길이, 크기, 위치를 설정하여 영상을 만드세요.</p>
    </header>

    <div class="upload-section">
      <div id="dropZone" class="drop-zone">
        <div class="drop-zone-content">
          <span class="drop-zone-icon">📁</span>
          <p class="drop-zone-text">이미지를 여기로 드래그하거나</p>
          <label for="imageInput" class="upload-btn">
            <span>파일 선택</span>
            <input type="file" id="imageInput" accept="image/*" multiple>
          </label>
          <p class="drop-zone-hint">여러 이미지를 동시에 선택할 수 있습니다</p>
        </div>
      </div>
    </div>

    <div class="output-settings-section">
      <h3>🎬 영상 출력 설정</h3>

      <div class="resolution-settings">
        <h4>해상도</h4>
        <select id="resolutionPreset">
          <optgroup label="일반">
            <option value="mobile">모바일 (720×1280) 세로</option>
            <option value="hd">HD (1280×720)</option>
            <option value="fullhd" selected>Full HD (1920×1080) 권장</option>
            <option value="4k">4K (3840×2160)</option>
          </optgroup>
          <optgroup label="SNS">
            <option value="instagram-square">인스타그램 정사각형 (1080×1080)</option>
            <option value="instagram-story">인스타그램 스토리 (1080×1920)</option>
            <option value="youtube">YouTube (1920×1080)</option>
            <option value="tiktok">TikTok (1080×1920)</option>
          </optgroup>
          <optgroup label="기타">
            <option value="custom">사용자 정의</option>
          </optgroup>
        </select>

        <div id="customResolutionInputs" class="custom-resolution" style="display: none;">
          <label>너비: <input type="number" id="customWidth" value="1920" min="320" max="7680"> px</label>
          <button id="swapDimensions" type="button" title="가로/세로 전환">🔄</button>
          <label>높이: <input type="number" id="customHeight" value="1080" min="240" max="4320"> px</label>
          <label class="lock-ratio">
            <input type="checkbox" id="lockAspectRatio" checked> 비율 고정
          </label>
        </div>
      </div>

      <div class="quality-settings">
        <h4>품질</h4>
        <select id="qualityPreset">
          <option value="low">저화질 (2 Mbps) - 빠른 업로드용</option>
          <option value="medium" selected>중간 (5 Mbps) - 권장</option>
          <option value="high">고화질 (10 Mbps)</option>
          <option value="ultra">최고화질 (20 Mbps) - 대용량</option>
        </select>
      </div>

      <div class="fps-settings">
        <h4>프레임레이트</h4>
        <label>FPS: <input type="number" id="fps" value="30" min="24" max="60"></label>
      </div>

      <div class="format-settings">
        <h4>출력 포맷</h4>
        <select id="outputFormat">
          <option value="webm">WebM (빠름, 모든 브라우저 지원)</option>
          <option value="mp4">MP4 (호환성 최고, 변환 시간 추가)</option>
          <option value="both">WebM + MP4(둘 다 생성)</option>
        </select>
        <p class="format-note" id="formatNote">※ MP4는 WebM 생성 후 변환됩니다 (+10-20초)</p>
      </div>

      <div class="output-info">
        <div class="info-row">
          <span>📐 출력 크기:</span>
          <strong id="outputSizeDisplay">1920 × 1080 px</strong>
        </div>
        <div class="info-row">
          <span>📊 종횡비:</span>
          <strong id="aspectRatioDisplay">16:9</strong>
        </div>
        <div class="info-row">
          <span>⏱️ 예상 길이:</span>
          <strong id="totalDurationDisplay">0초</strong>
        </div>
        <div class="info-row">
          <span>💾 예상 용량:</span>
          <strong id="estimatedSizeDisplay">0 MB</strong>
        </div>
        <p class="info-note">※ 실제 용량은 내용에 따라 다를 수 있습니다</p>
      </div>
    </div>

    <div class="common-settings">
      <h3>공통 이미지 설정 (기본값)</h3>
      <p class="settings-description">새로 추가되는 이미지에 적용될 기본값입니다. 기존 이미지에도 일괄 적용할 수 있습니다.</p>

      <h4 class="subsection-title">기본 설정</h4>
      <div class="setting-row">
        <label>재생 시간 (초): <input type="number" id="defaultDuration" value="3" min="0.1" step="0.1"></label>
        <label>너비 (%): <input type="number" id="defaultWidth" value="100" min="1" max="200"></label>
        <label>높이 (%): <input type="number" id="defaultHeight" value="100" min="1" max="200"></label>
      </div>
      <div class="setting-row">
        <label>X 위치 (%): <input type="number" id="defaultX" value="0" min="-100" max="100"></label>
        <label>Y 위치 (%): <input type="number" id="defaultY" value="0" min="-100" max="100"></label>
        <label>맞춤 방식:
          <select id="defaultFit">
            <option value="cover">채우기 (Cover)</option>
            <option value="contain">맞추기 (Contain)</option>
            <option value="fill">늘리기 (Fill)</option>
          </select>
        </label>
      </div>

      <h4 class="subsection-title">시각 효과</h4>
      <div class="setting-row">
        <label>배경색: <input type="color" id="defaultBgColor" value="#000000"></label>
        <label class="checkbox-label">
          <input type="checkbox" id="defaultBgEnabled" checked> 배경색 사용
        </label>
      </div>

      <div class="setting-row">
        <label class="checkbox-label">
          <input type="checkbox" id="defaultBorderEnabled"> 테두리 사용
        </label>
        <label>테두리 색상: <input type="color" id="defaultBorderColor" value="#ffffff"></label>
        <label>테두리 두께 (px): <input type="number" id="defaultBorderWidth" value="5" min="1" max="50"></label>
      </div>

      <div class="setting-row">
        <label class="checkbox-label">
          <input type="checkbox" id="defaultShadowEnabled"> 그림자 사용
        </label>
        <label>그림자 색상: <input type="color" id="defaultShadowColor" value="#000000"></label>
        <label>그림자 블러 (px): <input type="number" id="defaultShadowBlur" value="10" min="0" max="100"></label>
      </div>
      <div class="setting-row">
        <label>그림자 X 오프셋 (px): <input type="number" id="defaultShadowX" value="5" min="-100" max="100"></label>
        <label>그림자 Y 오프셋 (px): <input type="number" id="defaultShadowY" value="5" min="-100" max="100"></label>
      </div>

      <div class="setting-actions">
        <button id="saveDefaultsBtn" class="save-defaults-btn">기본값 저장</button>
        <button id="applyToAllBtn" class="apply-to-all-btn" disabled>모든 이미지에 적용</button>
        <button id="resetDefaultsBtn" class="reset-defaults-btn">초기값으로 복원</button>
        <button id="randomAnimationsBtn" class="random-animations-btn" disabled>🎲 랜덤 애니메이션 배정</button>
      </div>

      <div class="preset-section">
        <h4 class="subsection-title">⭐ 프리셋</h4>
        <div class="preset-controls">
          <input type="text" id="presetNameInput" placeholder="프리셋 이름 입력..." class="preset-name-input">
          <button id="savePresetBtn" class="preset-btn">💾 저장</button>
          <select id="presetSelect" class="preset-select">
            <option value="">프리셋 선택...</option>
          </select>
          <button id="loadPresetBtn" class="preset-btn" disabled>📥 불러오기</button>
          <button id="deletePresetBtn" class="preset-btn delete-btn" disabled>🗑️ 삭제</button>
        </div>
      </div>
    </div>

    <div class="storyboard-section">
      <h3>📸 이미지 스토리보드</h3>
      <p class="storyboard-hint">이미지를 클릭하여 설정 변경 • 드래그하여 순서 변경</p>
      <div id="imageList" class="image-storyboard"></div>
    </div>

    <div class="preview-section">
      <div class="preview-header">
        <h3>미리보기</h3>
        <div class="preview-controls">
          <button id="playPreviewBtn" class="preview-btn preview-play-btn" title="애니메이션 재생">▶️</button>
          <button id="zoomOutBtn" class="preview-btn" title="축소">🔍−</button>
          <button id="zoomResetBtn" class="preview-btn" title="원본 크기">100%</button>
          <button id="zoomInBtn" class="preview-btn" title="확대">🔍+</button>
          <button id="fitScreenBtn" class="preview-btn" title="화면에 맞춤">⛶</button>
          <label class="preview-checkbox">
            <input type="checkbox" id="showGridBtn"> 그리드
          </label>
          <label class="preview-checkbox">
            <input type="checkbox" id="showSafeAreaBtn"> 안전영역
          </label>
        </div>
      </div>
      <div class="canvas-container" id="canvasContainer">
        <canvas id="previewCanvas"></canvas>
        <canvas id="overlayCanvas"></canvas>
      </div>
    </div>

    <div class="action-buttons">
      <button id="generateBtn" class="generate-btn" disabled>🎬 영상 생성하기</button>
      <button id="cancelGenerationBtn" class="cancel-generation-btn" style="display: none;">⏹️ 취소</button>
      <button id="clearBtn" class="clear-btn">🗑️ 모두 지우기</button>
    </div>

    <!-- 이미지 설정 모달 -->
    <div id="imageModal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>이미지 설정</h3>
          <button class="modal-close" id="modalCloseBtn">&times;</button>
        </div>
        <div class="modal-body" id="modalBody">
          <!-- 이미지 설정 폼이 여기에 동적으로 추가됩니다 -->
        </div>
        <div class="modal-footer">
          <button class="modal-btn modal-btn-secondary" id="modalCancelBtn">취소</button>
          <button class="modal-btn modal-btn-primary" id="modalSaveBtn">저장</button>
        </div>
      </div>
    </div>

    <div id="progress" class="progress-section" style="display: none;">
      <div class="progress-bar">
        <div id="progressBar" class="progress-fill"></div>
      </div>
      <p id="progressText">처리 중...</p>
    </div>
  </div>

  <!-- FFmpeg.wasm for MP4 conversion -->
  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.12.10/dist/umd/ffmpeg.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/util@0.12.1/dist/umd/index.min.js"></script>

  <script src="app.js"></script>
  <script src="storyboard-functions.js"></script>
</body>
</html>
